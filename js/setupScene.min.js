function loadModel(path){var parseConfig=()=>{var loadTextures=textures=>{var result={};for(var id in textures){var tex=(new THREE.TextureLoader).load(path+textures[id]);tex.magFilter=THREE.NearestFilter,tex.minFilter=THREE.LinearMipMapLinearFilter,result[id]=tex}return result},loadMaterials=(textures,materials)=>{var result={};for(var id in materials){var values={side:THREE.DoubleSide,color:16777215};switch(value=materials[id],value.substr(0,1)){case"#":values.color=parseInt(value.substr(1,6),16);break;case"!":values.color=values.emissive=parseInt(value.substr(1,6),16);break;default:values.map=textures[value],values.transparent=!0,values.opacity=1,values.alphaTest=.5}result[id]=values}return result},config={};return getJSON(path+"data.json",toParse=>{config.textures=loadTextures(toParse.textures),config.materials=loadMaterials(config.textures,toParse.materials),toParse.hasOwnProperty("camera_offset")&&(config.camera_offset=toParse.camera_offset),config.seats=toParse.seats,config.test=toParse.test}),config};"/"!=path[path.length-1]&&(path+="/");var setupMaterial=(material,config)=>{Array.isArray(material)?material.forEach(child=>setupMaterial(child,config)):config.hasOwnProperty(material.name)&&material.setValues(config[material.name])},model={calculateSeatPosition:(sector,row,col,lookAt0)=>{var O3D=new THREE.Object3D;lookAt0=lookAt0||!1;var config="object"==typeof sector?sector:model.config.seats[sector];if(row=row||0,col=col-1||0,config.hasOwnProperty("rows"))for(var i=0;i<config.max;i++){if(row<=config.rows[i].max.rows){config=config.rows[i];break}row-=config.rows[i].max.rows}return row-=1,(config.hasOwnProperty("position")||config.hasOwnProperty("origin"))&&O3D.position.set(...config.position||config.origin),O3D.rotation.order="YXZ",O3D.rotation.set(0,0,0),config.hasOwnProperty("rotation")&&O3D.rotation.set(...config.rotation.inverse(),0),model.config.hasOwnProperty("camera_offset")&&O3D.translateOnAxis(new THREE.Vector3(...model.config.camera_offset),1),config.hasOwnProperty("max")&&config.hasOwnProperty("offset")&&(col=col.clamp(0,config.max.cols-1),row=row.clamp(0,config.max.rows-1),O3D.translateX(config.offset[0]*col),O3D.translateY(config.offset[1]*row),O3D.translateZ(config.offset[2]*row)),lookAt0&&(O3D.lookAt(0,0,0),O3D.rotateY(Math.PI)),{position:O3D.position.toArray(),rotation:O3D.rotation.toArray().slice(0,3)}}};return model.config=parseConfig(path),loader.load(path+"data.fbx",object=>{if(object.traverse(child=>{child.isMesh&&(child.castShadow=!0,child.receiveShadow=!0,setupMaterial(child.material,model.config.materials))}),model.object=object,model.object.castShadow=!0,model.object.receiveShadow=!0,scene.add(model.object),controls.load()||controls.changeView(model.config.seats.default),addSeatToCombobox)for(index in model.config.seats)"default"!=index&&addSeatToCombobox(index)}),model}function createSkybox(path){for(var texLoader=new THREE.TextureLoader,skyboxPath="skybox/"+path+"/",directions=["px","nx","py","ny","pz","nz"],skyGeometry=new THREE.CubeGeometry(5e3,5e3,5e3),skyMaterial=[],i=0;i<6;i++)skyMaterial.push(new THREE.MeshBasicMaterial({map:texLoader.load(skyboxPath+directions[i]+".jpg"),side:THREE.BackSide}));return new THREE.Mesh(skyGeometry,skyMaterial)}var viewport2d,renderer2d,viewport3d,renderer3d,width,height,controls,loader,renderer2dBuffer,renderer3dBuffer,scene,camera,cameraTop,model;function updateRendererSize(e){width=viewport3d.offsetWidth,height=viewport3d.offsetHeight,renderer3d.setSize(width,height),camera&&(camera.aspect=width/height,camera.updateProjectionMatrix())}function update(){requestAnimationFrame(update),controls.update(),renderer3d.render(scene,camera)}function init(){var light;viewport3d=document.getElementById("viewport3D"),(renderer3d=new THREE.WebGLRenderer({antialias:!0,premultipliedAlpha:!1})).setPixelRatio(2),viewport3d.appendChild(renderer3d.domElement),updateRendererSize(),loader=new THREE.FBXLoader,(scene=new THREE.Scene).add(createSkybox(SKYBOX)),camera=new THREE.PerspectiveCamera(60,width/height,.1,1e4),controls=new CameraControls(camera,renderer3d.domElement),(light=new THREE.PointLight(16777215,1,0)).position.set(0,70,0),scene.add(light);var light=new THREE.AmbientLight(6250335);scene.add(light),model=loadModel(MODEL_NAME),update()}function startup(){WEBGL.isWebGLAvailable()?init():document.body.appendChild(WEBGL.getWebGLErrorMessage()),window.addEventListener("resize",updateRendererSize,!1)}Number.prototype.clamp=function(min,max){return Math.min(max,Math.max(min,this))},Array.prototype.inverse=function(){for(var result=[],i=this.length-1;i>=0;i--)result.push(this[i]);return result};